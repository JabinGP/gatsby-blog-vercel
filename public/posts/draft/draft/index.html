<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-bdea88e09b7f8410f683.js"/><link as="script" rel="preload" href="/framework-69325bf178eabe561408.js"/><link as="script" rel="preload" href="/app-2deb71b93cea1e7c3bc6.js"/><link as="script" rel="preload" href="/fc5f04a35196630035e48e6cf132e09717cbb752-01e1c9471858dbd4c594.js"/><link as="script" rel="preload" href="/component---src-pages-post-js-4f36622614943fb52cbc.js"/><link as="fetch" rel="preload" href="/page-data/posts/draft/draft/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-dkPtRN kgstGl"><div class="sc-hKwDye cUWynP"><h1>草稿<!-- -->（草稿）</h1><h3>2021-01-15 13:24</h3></div><div id="stylemd" class="sc-bdvvtL CDwmm"><h2>1. PCB</h2><p>进程的另一个名字是 <strong>任务（task）</strong> 。 Linux 内核通常把进程也叫做任务。</p><p>前文也提到过PCB，这是进程在操作系统中的数据结构，而众所周知 Linux 是用 C 语言编写的开源操作系统，因此我们可以看看 Linux 的源码中是如何定义PCB的。</p><p>在 Linux 源码中PCB被定义为 <strong>task_struct</strong>， 由于其完整定义有 <strong>700+</strong> 行，便于浏览这里只摘出了部分比较常用的属性：</p><div class="gatsby-highlight" data-language="c"><pre class="prism-code language-c"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">task_struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">pid_t</span><span class="token plain">               pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">pid_t</span><span class="token plain">               tgid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/* -1 unrunnable, 0 runnable, &gt;0 stopped: */</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">volatile</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">long</span><span class="token plain">           state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">            policy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">         prio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">             exit_state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">             exit_code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">             exit_signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/* The signal sent when the parent dies: */</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain">             pdeath_signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">unsigned</span><span class="token plain">            in_execve</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">unsigned</span><span class="token plain">            in_iowait</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/* Real parent process: */</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">task_struct</span><span class="token plain"> __rcu    </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">real_parent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/* Recipient of SIGCHLD, wait4() reports: */</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">task_struct</span><span class="token plain"> __rcu    </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">parent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">/*</span></div><div class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     * Children/sibling form the list of natural children:</span></div><div class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">list_head</span><span class="token plain">        children</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">list_head</span><span class="token plain">        sibling</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">task_struct</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">group_leader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">list_head</span><span class="token plain">        tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span></div></pre></div><h2>2. 父进程与子进程</h2><h3>2.1 进程家族树</h3><p>说到父进程与子进程 ，就不得不提到Unix的 <strong>进程家族树</strong> 。</p><p>Unix 的进程之间存在一个明显的继承关系，所有的进程都是 PID 为1的 init 进程的后代（排除一些内核进程，他们是 0号进程的后代）。内核在系统启动的最后阶段启动 init 进程，该进程读取系统的初始化脚本（initscript）并执行其他的相关程序，最终完成系统启动的整个过程。</p><p>系统中的每个进程必有一个父进程，相应的每个进程也可以拥有零个或多个子进程。拥有同一个父进程的所有进程被成为兄弟。进程间的关系存放在 task_struct 中。每个 task_struct 包含一个指向其父进程 task_struct 的指针，叫做 <strong>parent</strong> 指针，还包含了一个称为 <strong>children</strong> 的子进程链表。</p><h3>2.2 进程的创建</h3><p>许多其他的操作系统都提供 <strong>产生（spawn）</strong> 进程的机制，即在新的地址空间创建进程，读入可执行文件，最后开始执行。</p><p>但 Unix 的进程创建很特别，它将上述步骤分解到两个单独的函数 <strong>fork()</strong> 和 <strong>exec()</strong> 中去执行。</p><h4>2.2.1 fork()</h4><p>首先，fork() 通过 <strong>拷贝</strong> 当前进程创建一个子进程，此时该子进程与父进程的区别仅仅在于 PID（每个进程具有唯一的 PID ） 、PPID（子进程的 PPID 将是被拷贝进程的 PID ）和某些资源和统计量（例如，挂起的信号，它没有必要被继承）。</p><p>fork() 被调用一次，但会在父进程和新产生的子进程中各返回一次（共返回两次）。两次返回的区别是子进程得到的返回值是0，而父进程得到的返回值是新的子进程的 PID 。</p><p>fork() 让父进程得到子进程的 PID 的原因是：一个进程的子进程可以有多个，并且除了 fork() 的返回值外，没有任何一个函数能够得到该子进程的 PID 了。</p><p>fork() 让子进程得到返回值0的原因是：一个进程有且只有一个父进程，所以子进程可以通过 getppid() 来得到父进程的 PID ，并且返回值是否为0可以判断当前进程是否是新创建的子进程（尽管在系统中的的确确存在 PID 为0的进程，但0号进程是内核进程，并且是整个系统中的第一个进程，所以不可能是一个子进程的 PID）。</p><h5>2.2.1.1 fork() 示例</h5><p>这是一个非常简单的 fork() 示例，运行这个示例你将会明白返回两次是什么意思。</p><div class="gatsby-highlight" data-language="c"><pre class="prism-code language-c"><div class="token-line" style="color:#000000"><span class="token plain">include</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">stdio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">h</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(0, 0, 255)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(163, 21, 21)">&lt;unistd.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> pid </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fork</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;pid = %d\n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><h4>2.2.2 exec()</h4><p>exec() 函数负责读取可执行文件，并将其载入地址空间开始运行。exec() 指所有 exec() 一族的函数，包括 execve() 、 execlp()、 execle() 、 execv() 、 execvp() 等。</p><p>进程执行 exec() 程序时，该进程执行的程序完全替换为新程序，且新程序从 main 函数（回想 C 语言的 main 函数）开始执行。因为 exec() 只是用全新的程序替换了当前进程的正文、数据、堆和栈段，因此 exec() 并不会产生新的进程，更并不会改变当前进程的 PID。</p><h4>2.2.3 组合使用 fork() 和 exec()</h4><p>在 Unix 中创建一个新进程的方式是先使用 fork() ，通过 fork() 的返回值判断出哪个是子进程，并在子进程中执行 exec() 。下面是一个简单的 C 语言代码示例：</p><div class="gatsby-highlight" data-language="c"><pre class="prism-code language-c"><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div></pre></div><h2>进程组</h2><h2>会话组</h2><h2>Nginx 配置</h2><div class="gatsby-highlight" data-language="Nginx"><pre class="prism-code language-Nginx"><div class="token-line" style="color:#000000"><span class="token plain">##</span></div><div class="token-line" style="color:#000000"><span class="token plain"># You should look at the following URL&#x27;s in order to grasp a solid understanding</span></div><div class="token-line" style="color:#000000"><span class="token plain"># of Nginx configuration files in order to fully unleash the power of Nginx.</span></div><div class="token-line" style="color:#000000"><span class="token plain"># https://www.nginx.com/resources/wiki/start/</span></div><div class="token-line" style="color:#000000"><span class="token plain"># https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</span></div><div class="token-line" style="color:#000000"><span class="token plain"># https://wiki.debian.org/Nginx/DirectoryStructure</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain"># In most cases, administrators will remove this file from sites-enabled/ and</span></div><div class="token-line" style="color:#000000"><span class="token plain"># leave it as reference inside of sites-available where it will continue to be</span></div><div class="token-line" style="color:#000000"><span class="token plain"># updated by the nginx packaging team.</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain"># This file will automatically load configuration files provided by other</span></div><div class="token-line" style="color:#000000"><span class="token plain"># applications, such as Drupal or Wordpress. These applications will be made</span></div><div class="token-line" style="color:#000000"><span class="token plain"># available underneath a path with that package name, such as /drupal8.</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain"># Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</span></div><div class="token-line" style="color:#000000"><span class="token plain">##</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"># Default server configuration</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain">server {</span></div><div class="token-line" style="color:#000000"><span class="token plain">    listen 80 default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    listen [::]:80 default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # SSL configuration</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # listen 443 ssl default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # listen [::]:443 ssl default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Note: You should disable gzip for SSL traffic.</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # See: https://bugs.debian.org/773332</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Read up on ssl_ciphers to ensure a secure configuration.</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # See: https://bugs.debian.org/765782</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Self signed certs generated by the ssl-cert package</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Don&#x27;t use them in a production server!</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # include snippets/snakeoil.conf;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #root /var/www/html;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Add index.php to the list if you are using PHP</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #index index.html index.htm index.nginx-debian.html;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    server_name _;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#000000"><span class="token plain">        # First attempt to serve request as file, then</span></div><div class="token-line" style="color:#000000"><span class="token plain">        # as directory, then fall back to displaying a 404.</span></div><div class="token-line" style="color:#000000"><span class="token plain">        try_files $uri $uri/ =404;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    }</span></div><div class="token-line" style="color:#000000"><span class="token plain">    location /mike/ {</span></div><div class="token-line" style="color:#000000"><span class="token plain">        alias /home/mike/nginx-folder/;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    }</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # pass PHP scripts to FastCGI server</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #location ~ \.php$ {</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   include snippets/fastcgi-php.conf;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   # With php-fpm (or other unix sockets):</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   # With php-cgi (or other tcp sockets):</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   fastcgi_pass 127.0.0.1:9000;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #}</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # deny access to .htaccess files, if Apache&#x27;s document root</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # concurs with nginx&#x27;s one</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #location ~ /\.ht {</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   deny all;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #}</span></div><div class="token-line" style="color:#000000"><span class="token plain">}</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"># Virtual Host configuration for example.com</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain"># You can move that to a different file under sites-available/ and symlink that</span></div><div class="token-line" style="color:#000000"><span class="token plain"># to sites-enabled/ to enable it.</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">server {</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # SSL configuration</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span></div><div class="token-line" style="color:#000000"><span class="token plain">    #listen 443 ssl default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #listen [::]:443 ssl default_server;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Note: You should disable gzip for SSL traffic.</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # See: https://bugs.debian.org/773332</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Read up on ssl_ciphers to ensure a secure configuration.</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # See: https://bugs.debian.org/765782</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Self signed certs generated by the ssl-cert package</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Don&#x27;t use them in a production server!</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # include snippets/snakeoil.conf;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #root /var/www/html;</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # Add index.php to the list if you are using PHP</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #index index.html index.htm index.nginx-debian.html;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    server_name hk1.jabni.top; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">        location / {</span></div><div class="token-line" style="color:#000000"><span class="token plain">            proxy_http_version 1.1;</span></div><div class="token-line" style="color:#000000"><span class="token plain">                proxy_set_header Host $host;</span></div><div class="token-line" style="color:#000000"><span class="token plain">                proxy_set_header X-Real-IP $remote_addr;</span></div><div class="token-line" style="color:#000000"><span class="token plain">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></div><div class="token-line" style="color:#000000"><span class="token plain">               proxy_pass http://127.0.0.1:3000;</span></div><div class="token-line" style="color:#000000"><span class="token plain">        }</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # pass PHP scripts to FastCGI server</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #location ~ \.php$ {</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   include snippets/fastcgi-php.conf;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   # With php-fpm (or other unix sockets):</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   # With php-cgi (or other tcp sockets):</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   fastcgi_pass 127.0.0.1:9000;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #}</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # deny access to .htaccess files, if Apache&#x27;s document root</span></div><div class="token-line" style="color:#000000"><span class="token plain">    # concurs with nginx&#x27;s one</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #location ~ /\.ht {</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #   deny all;</span></div><div class="token-line" style="color:#000000"><span class="token plain">    #}</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    listen [::]:443 ssl ipv6only=on; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain">    listen 443 ssl; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain">    ssl_certificate /etc/letsencrypt/live/hk1.jabni.top/fullchain.pem; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain">    ssl_certificate_key /etc/letsencrypt/live/hk1.jabni.top/privkey.pem; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">}</span></div><div class="token-line" style="color:#000000"><span class="token plain"># server {</span></div><div class="token-line" style="color:#000000"><span class="token plain">#     if ($host = hk1.jabni.top) {</span></div><div class="token-line" style="color:#000000"><span class="token plain">#         return 301 https://$host$request_uri;</span></div><div class="token-line" style="color:#000000"><span class="token plain">#     } # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain"># </span></div><div class="token-line" style="color:#000000"><span class="token plain"># </span></div><div class="token-line" style="color:#000000"><span class="token plain">#   listen 80 ;</span></div><div class="token-line" style="color:#000000"><span class="token plain">#   listen [::]:80 ;</span></div><div class="token-line" style="color:#000000"><span class="token plain">#     server_name hk1.jabni.top;</span></div><div class="token-line" style="color:#000000"><span class="token plain">#     return 404; # managed by Certbot</span></div><div class="token-line" style="color:#000000"><span class="token plain"># </span></div><div class="token-line" style="color:#000000"><span class="token plain"># </span></div><div class="token-line" style="color:#000000"><span class="token plain"># }</span></div></pre></div><h2>docker</h2><ul><li>/home/docker-data/murmur:/data 本机的 /home/docker-data/murmur 映射为 /data</li></ul><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">$ docker pull coppit/mumble-server</span></div><div class="token-line" style="color:#000000"><span class="token plain">$ docker run --name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mumble-server -d --net</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">host -v /home/docker-data/murmur:/data -t coppit/mumble-server</span></div></pre></div><h2>docker -1</h2><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">$ docker pull phlak/mumble</span></div><div class="token-line" style="color:#000000"><span class="token plain">$ docker run -d -p </span><span class="token number" style="color:rgb(9, 134, 88)">64738</span><span class="token plain">:64738 -p </span><span class="token number" style="color:rgb(9, 134, 88)">64738</span><span class="token plain">:64738/udp -v mumble-data:/etc/mumble --name mumble-server phlak/mumble</span></div></pre></div><ul><li>[docker-mumble]<!-- --> (<a href="https://github.com/PHLAK/docker-mumble">https://github.com/PHLAK/docker-mumble</a>)</li></ul><p>数据将被放在 /var/lib/docker/volumes/mumble-data/_data
可以通过这个命令看到</p><p>docker inspect mumble-server | less</p><p>docker run -d -p 64739:64738 -p 64739:64738/udp -v /home/docker-data/murmur:/etc/mumble --name mumble-server-1 phlak/mumble</p><ul><li><a href="https://zhuanlan.zhihu.com/p/43105630">docker容器中无权限操作挂载宿主机的目录解决方案</a></li></ul><p>&quot;Propagation&quot;:&quot;rprivate&quot; } ], 从里面可以出这是一个 bind mount,并且是只读挂载。</p><ul><li><a href="https://blog.csdn.net/wangzan18/article/details/85219442">Docker 持久存储介绍(十三)</a></li></ul><div class="gatsby-highlight" data-language=""><pre class="prism-code language-"><div class="token-line" style="color:#000000"><span class="token plain">$ docker pull mysql:latest</span></div><div class="token-line" style="color:#000000"><span class="token plain">$ docker images</span></div></pre></div><p>172.17.0.1
docker run -d --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=docker.for.mac.host.internal:2181/kafka -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://docker.for.mac.host.internal:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 wurstmeister/kafka</p><p>docker run -d --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=172.17.0.1:2181/kafka -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://172.17.0.1:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 wurstmeister/kafka</p><p>kafka 启动不了 内存不够</p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-"><div class="token-line" style="color:#000000"><span class="token plain">Excluding KAFKA_HOME from broker config</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;port&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;advertised.listeners&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;broker.id&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">Excluding KAFKA_VERSION from broker config</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;listeners&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;zookeeper.connect&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">[Configuring] &#x27;log.dirs&#x27; in &#x27;/opt/kafka/config/server.properties&#x27;</span></div><div class="token-line" style="color:#000000"><span class="token plain">#</span></div><div class="token-line" style="color:#000000"><span class="token plain"># There is insufficient memory for the Java Runtime Environment to continue.</span></div><div class="token-line" style="color:#000000"><span class="token plain"># Native memory allocation (mmap) failed to map 1073741824 bytes for committing reserved memory.</span></div><div class="token-line" style="color:#000000"><span class="token plain">OpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000c0000000, 1073741824, 0) failed; error=&#x27;Out of memory&#x27; (errno=12)</span></div><div class="token-line" style="color:#000000"><span class="token plain"># An error report file with more information is saved as:</span></div><div class="token-line" style="color:#000000"><span class="token plain"># //hs_err_pid1.log</span></div></pre></div><h2>nat 协议</h2><p>NAT转换是怎么工作的？ - 网易云信的回答 - 知乎
<a href="https://www.zhihu.com/question/31332694/answer/470426521">https://www.zhihu.com/question/31332694/answer/470426521</a></p><h2>docker gitea</h2><p>docker run -d -p 3000:3000  -p 3322:22 -v gitea-data:/data/gitea --name gitea gitea/gitea   </p><p><a href="https://stackoverflow.com/questions/64416940/docker-every-command-results-in-a-fatal-error-runtime-out-of-memory">https://stackoverflow.com/questions/64416940/docker-every-command-results-in-a-fatal-error-runtime-out-of-memory</a></p><p><a href="https://www.cnblogs.com/atuotuo/p/13549012.html">https://www.cnblogs.com/atuotuo/p/13549012.html</a></p><p><a href="https://blog.csdn.net/u010117864/article/details/104952104">https://blog.csdn.net/u010117864/article/details/104952104</a></p><div class="gatsby-highlight" data-language=""><pre class="prism-code language-"><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:~# free -m</span></div><div class="token-line" style="color:#000000"><span class="token plain">              total        used        free      shared  buff/cache   available</span></div><div class="token-line" style="color:#000000"><span class="token plain">Mem:            923         761          63           5          99          41</span></div><div class="token-line" style="color:#000000"><span class="token plain">Swap:             0           0           0</span></div><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:~#</span></div></pre></div><div class="gatsby-highlight" data-language=""><pre class="prism-code language-"><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:~# cd /usr/</span></div><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:/usr# mkdir swap</span></div></pre></div><div class="gatsby-highlight" data-language=""><pre class="prism-code language-"><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:/usr/swap# dd if=/dev/zero of=swapfile bs=1M count=2048</span></div><div class="token-line" style="color:#000000"><span class="token plain">2048+0 records in</span></div><div class="token-line" style="color:#000000"><span class="token plain">2048+0 records out</span></div><div class="token-line" style="color:#000000"><span class="token plain">2147483648 bytes (2.1 GB, 2.0 GiB) copied, 30.4012 s, 70.6 MB/s</span></div><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:/usr/swap# mkswap swapfile</span></div><div class="token-line" style="color:#000000"><span class="token plain">mkswap: swapfile: insecure permissions 0644, 0600 suggested.</span></div><div class="token-line" style="color:#000000"><span class="token plain">Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)</span></div><div class="token-line" style="color:#000000"><span class="token plain">no label, UUID=08dbc4e3-24b5-4377-a7f0-0b8fc088d93a</span></div><div class="token-line" style="color:#000000"><span class="token plain">root@aligz01:/usr/swap# swapon swapfile</span></div><div class="token-line" style="color:#000000"><span class="token plain">swapon: /usr/swap/swapfile: insecure permissions 0644, 0600 suggested.</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">$ &quot;/usr/swap/swapfile swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab</span></div></pre></div><p>其中，if表示input_file输入文件，of表示output_file输出文件，bs表示block_size块大小，count表示计数。这里，我采用了数据块大小为1M，数据块数目为2048，这样分配的空间就是2G大小。</p><p><a href="http://www.lining0806.com/linux%E4%B8%8B%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/">http://www.lining0806.com/linux%E4%B8%8B%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/</a></p><h2>tty</h2><p>强推 <a href="http://www.linusakesson.net/programming/tty/index.php">The TTY demystified</a></p><ul><li>what is tty</li><li>what is control terminal</li><li>what is terminal</li><li>what is shell</li><li>what is /dev/tty</li><li>what is stdin and stdout</li><li></li></ul><p>在 Unix 中 ，<code>tty</code> 是一个命令，用来输出终端连接标准输入的文件名。</p><p>tty 是 TeleTYpewriter 的缩写，TeleTYpewriter 的中文意思是电传打字电报机，这是一种用来发送键盘输入信息到远端的设备，它在 20 世纪中叶被广泛使用。电传打字电报机有一个用于输入的键盘、一个用来查看自己输入内容的本地的打印机、一个发射器，消息可以通过电线或无线电发送，</p><p>tty 命令通常用来检测当前的输出媒介是否为一个终端，若当前输出媒介为终端，该命令会输出当前终端标准输入的文件名，若不存在该标准输入文件，则说明当前输出媒介并非是一个终端（例如使用管道组合了命令的情况 <code>echo | tty | cat</code> ），执行 tty 命令将输出一个 “not a tty” 到标准输出并且以状态 1 退出来表示输出媒介并非终端。</p><ul><li><a href="http://www.linusakesson.net/programming/tty/index.php">http://www.linusakesson.net/programming/tty/index.php</a></li><li><a href="https://en.wikipedia.org/wiki/Tty_(unix)">https://en.wikipedia.org/wiki/Tty_(unix)</a></li><li><a href="https://linux.die.net/man/4/tty">https://linux.die.net/man/4/tty</a></li><li><a href="https://simple.wikipedia.org/wiki/Teletypewriter">https://simple.wikipedia.org/wiki/Teletypewriter</a></li><li><a href="https://stackoverflow.com/questions/8514735/what-is-special-about-dev-tty">https://stackoverflow.com/questions/8514735/what-is-special-about-dev-tty</a></li></ul><p>ubuntu 18.04 添加 sudo 权限</p><p>ubuntu里面没有wheel组，取而代之的是sudo，添加到sudo组即可</p><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">usermod</span><span class="token plain"> -a -G </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> jabin</span></div></pre></div><p>sudo docker run -d -p 64738:64738 -p 64738:64738/udp \
-v /opt/docker/mnt/murmur/data:/data \
-v /opt/docker/mnt/murmur/config/murmur.ini:/etc/murmur.ini \
--name=murmur \
mattikus/murmur</p><p>docker run --name mysql5_6 \
-v /opt/docker/mnt/mysql5_6/conf.d:/etc/mysql/conf.d \
-v /opt/docker/mnt/mysql5_6/data:/var/lib/mysql \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=abc123 \
-d mysql:5.6.50</p><p>sudo docker pull redis:latest</p><p>sudo docker run -itd \
--name redis \
-p 6379:6379 \
-v /opt/docker/mnt/redis/data:/data \
redis</p><p>sudo docker run -itd \
--name mongo \
-v /opt/docker/mnt/mongo/data:/data \
-p 27017:27017 \
-e MONGO_INITDB_ROOT_USERNAME=root \
-e MONGO_INITDB_ROOT_PASSWORD=abc123 \
mongo \
--auth</p><p>create database code_sharing charset utf8mb4 collate utf8mb4_unicode_ci</p></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/draft/draft";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-71841f628f9c8d668040.js"],"app":["/app-2deb71b93cea1e7c3bc6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-46407eeca50ec9ed10bd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-27ee89540f6f7df713b0.js"],"component---src-pages-post-js":["/component---src-pages-post-js-4f36622614943fb52cbc.js"]};/*]]>*/</script><script src="/polyfill-71841f628f9c8d668040.js" nomodule=""></script><script src="/component---src-pages-post-js-4f36622614943fb52cbc.js" async=""></script><script src="/fc5f04a35196630035e48e6cf132e09717cbb752-01e1c9471858dbd4c594.js" async=""></script><script src="/app-2deb71b93cea1e7c3bc6.js" async=""></script><script src="/framework-69325bf178eabe561408.js" async=""></script><script src="/webpack-runtime-bdea88e09b7f8410f683.js" async=""></script></body></html>
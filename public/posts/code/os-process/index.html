<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-97dd88bd1a8334b86a8b.js"/><link as="script" rel="preload" href="/framework-69325bf178eabe561408.js"/><link as="script" rel="preload" href="/app-83ce6fd2f1ccc517e165.js"/><link as="script" rel="preload" href="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-57175e9be9b06b4bcea2.js"/><link as="script" rel="preload" href="/component---src-pages-post-js-89ead2517795a9cdec6e.js"/><link as="fetch" rel="preload" href="/page-data/posts/code/os-process/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-gsDKAQ bfoVMF"><div class="sc-dkPtRN bZTKrI"><h1>操作系统系列之——进程</h1><h3>2020-12-22 13:24</h3></div><div id="stylemd" class="sc-bdvvtL hlRsZa"><h2>说明</h2><p>注意，在阅读这篇文章之前，请确保你已经具备以下文章中的知识：</p><ul><li><a href="/posts/code/os-program/">操作系统系列之——程序</a></li></ul><p>本篇文章试图让你感受到进程与程序的区别，较为深入的细节将留在后续的文章中。</p><h2>什么是进程</h2><blockquote><p>进程本质上是正在执行的一个程序，是对正在运行程序的一个抽象。——《现代操作系统》</p></blockquote><p>在<a href="https://blog.jabingp.cn//posts/code/linux-program/">操作系统系列之——程序</a>中，我们通过 C 语言和 gcc 编译器得到了一个被存放在硬盘中的程序 <code>a.out</code> ，当它被计算机执行时就会产生一个进程。</p><h2>执行一个程序就会产生进程</h2><p>直接在<code>a.out</code>所在目录通过相对路径执行这个程序，可以看到程序运行并将字符输出到了控制台中：</p><blockquote><p>其中<code>➜  c</code>是命令提示符，请忽略该部分，关注提示符后面的内容。</p></blockquote><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">➜  c ./a.out</span></div><div class="token-line" style="color:#000000"><span class="token plain">HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span></div></pre></div><p>可以看到程序中的 <code>printf</code> 被输出到当前的控制台中，说明程序确实被执行了，但这样似乎还无法证明在这个过程中有 <strong>进程</strong> 产生。为了证明进程的存在，我们需要做个小实验。</p><h2>进程的小实验</h2><blockquote><p>再次强调，以下代码适用于类Unix系统，不同操作系统之间需要使用的库和编译工具会有所不同。</p></blockquote><p>首先改造一下我们的经典 HelloWorld ，引入了<code>unistd</code>来实现睡眠一段时间，我们编写程序让屏幕每隔<code>4s</code>输出一条 <strong>带有编号的HelloWorld</strong> ，且限制一共输出三条。</p><div class="gatsby-highlight" data-language="c"><pre class="prism-code language-c"><div class="token-line" style="color:#000000"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(0, 0, 255)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(163, 21, 21)">&lt;stdio.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(0, 0, 255)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(163, 21, 21)">&lt;unistd.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(0, 0, 255)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SLEEP_SECONDS</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">SLEEP_SECONDS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;No.%d: HelloWorld!\n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>编译并运行，结果是符合预期的，同时注意结果中的命令提示符 <code>➜  c</code> ，它在程序执行完毕后才出现：</p><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">➜  c ./a.out</span></div><div class="token-line" style="color:#000000"><span class="token plain">No.0: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.1: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.2: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c</span></div></pre></div><p>为了达到实验的效果，我们需要用到 <code>&amp;</code> 这个符号，在命令的结尾加上 <code>&amp;</code> 则可以实现在后台运行该命令，这样我们就无需等待程序运行完毕，命令提示符会马上出现。</p><p>尝试一下加上<code>&amp;</code>会有什么变化：</p><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">➜  c ./a.out </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">63965</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c No.0: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.1: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.2: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  + </span><span class="token number" style="color:rgb(9, 134, 88)">63965</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain">       ./a.out</span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c</span></div></pre></div><p>可以看到加上 &amp; 后没有等待 a.out 的执行结束而直接输出了 <code>[1] 63965</code>（其实这就是进程的 pid ），并且 <strong>命令提示符</strong> 马上出现，这意味着我们可以直接进行下一步的操作而不用等待 a.out 运行完毕， a.out 的运行结果也会照旧输出到当前的控制台上。</p><p>现在我们可以知道<code>&amp;</code>的作用：</p><ul><li>让程序在后台运行</li><li>程序的输出依然不受影响</li></ul><p>现在我们可以做实验的最后一步了，首先执行一次的<code>./a.out &amp;</code>，回车后马上通过键盘的方向上键<code>↑</code>呼出<code>./a.out &amp;</code>再次执行一遍（一共执行两遍）。</p><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash"><div class="token-line" style="color:#000000"><span class="token plain">➜  c ./a.out </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">63691</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c ./a.out </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">63694</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c No.0: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.0: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.1: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.1: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">No.2: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  - </span><span class="token number" style="color:rgb(9, 134, 88)">63691</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain">       ./a.out</span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c No.2: HelloWorld</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  + </span><span class="token number" style="color:rgb(9, 134, 88)">63694</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain">       ./a.out</span></div><div class="token-line" style="color:#000000"><span class="token plain">➜  c</span></div></pre></div><p>我们执行了两遍同一个程序，输出的结果并不是依次顺序的<code>0-1-2-0-1-2</code>，而是有些乱序的<code>0-0-1-1-2-2</code>。</p><p>乱序的结果会给人一种有两个同样的程序在 <strong>同时执行</strong> 的感觉，但显然我们有且仅有一个存放在硬盘上的程序。这说明两次执行的的确确产生了两个 <strong>不同的</strong> 进程，尽管他们源于同一个程序，有着一样的运行逻辑。</p><h2>程序和进程的关系、区别</h2><p><code>a.out</code>是我们的程序，但程序只是一段指令，仅仅存放在硬盘上的话它就是死的（<strong>静态的</strong>），只要你的硬盘不坏，这个程序放一万年都是原来的那个程序。但程序执行产生的进程是活的（<strong>动态的</strong>），会随着时间的推移发生状态的改变，例如当所有指令运行完毕进程就会因为无事可做而终止了。</p><p>进程是由程序的执行产生的，而程序又可以被多次执行，自然地一个程序可以产生<strong>多个</strong>进程，但一个进程只能源于某一个程序。</p><blockquote><p>进程和程序间的区别是很微妙的，但非常重要。用一个比喻可以更容易理解这一点。想象一位有一手好厨艺的计算机科学家正在为她的女儿烘制生日蛋糕。他有做生日蛋糕的食谱，厨房里有所需的原料：面粉、鸡蛋、糖、香草汁等。在这个比喻中。做蛋糕的食谱就是程序，计算机科学家就是处理器（CPU）。而做蛋糕的各种原料就是输入数据。进程就是厨师阅读食谱、取来各种原料以及烘制蛋糕等一系列动作的总和。——《现代操作系统》</p></blockquote><h2>为什么需要引入进程的概念</h2><p>通过<code>2</code>和<code>3</code>的例子，现在你应该知道对程序和进程有比较明确的认知了。在深入一些，这个看起来和程序没有太大区别的进程到底是出于什么原因被引入的？</p><p>在今天的操作系统中，并发已经是一件非常司空见惯的事情了，一边听歌一边看博客，一边看电影一边聊天，这些在电脑上运行着的程序都是在 <strong>操作系统</strong> 的管理下达到同时运行互不影响的效果的。</p><p>我们的电脑中能够执行指令的 <strong>CPU</strong> 只有一个（暂时忽略多核CPU），多个进程之间之所以能够呈现出同时运行的效果，是因为每个程序都只能被CPU执行很小一段时间，在时间结束后操作系统就换上别的程序让CPU执行（想象在 <em>100ms</em> 的时间内，每个程序只运行 <em>5ms</em>）。CPU实际上是在 <strong>很快地切换执行</strong> 不同的程序，而不是真正在 <strong>同时执行</strong> 那么多程序。</p><p>而不断切换不同程序运行会导致有些程序还没运行完就失去CPU了，这要求操作系统能够知道每个程序当前的执行状态，以便于重新得到CPU时 <strong>还原现场</strong>，执行信息则是在每次程序失去CPU时被记录在特定的结构中（<strong>保存现场</strong>）。</p><p>归根结底，进程是操作系统出于对运行着的程序的管理需求（<strong>保存现场</strong> 是其中之一）而创造出来的，被操作系统附加了信息后的结构就是 <strong>PCB（进程控制块）</strong>，这是真实存在于我们的电脑中的 <strong>数据结构</strong> ，而进程只是这个结构的 <strong>抽象概念</strong> 。</p></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/code/os-process";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-71841f628f9c8d668040.js"],"app":["/app-83ce6fd2f1ccc517e165.js"],"component---src-pages-404-js":["/component---src-pages-404-js-46407eeca50ec9ed10bd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-990038c5763b601e59d3.js"],"component---src-pages-post-js":["/component---src-pages-post-js-89ead2517795a9cdec6e.js"],"component---src-pages-search-js":[]};/*]]>*/</script><script src="/polyfill-71841f628f9c8d668040.js" nomodule=""></script><script src="/component---src-pages-post-js-89ead2517795a9cdec6e.js" async=""></script><script src="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-57175e9be9b06b4bcea2.js" async=""></script><script src="/app-83ce6fd2f1ccc517e165.js" async=""></script><script src="/framework-69325bf178eabe561408.js" async=""></script><script src="/webpack-runtime-97dd88bd1a8334b86a8b.js" async=""></script></body></html>
<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-dea9e12160a7e4b9ddde.js"/><link as="script" rel="preload" href="/framework-69325bf178eabe561408.js"/><link as="script" rel="preload" href="/app-83ce6fd2f1ccc517e165.js"/><link as="script" rel="preload" href="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-2cd4cc2d289335376890.js"/><link as="script" rel="preload" href="/component---src-pages-post-js-89ead2517795a9cdec6e.js"/><link as="fetch" rel="preload" href="/page-data/posts/code/mini-program-music/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-dkPtRN kgstGl"><div class="sc-hKwDye cUWynP"><h1>在微信小程序使用播放音乐的方法，以及微信小程序播放背景音乐失败的解决方案汇总</h1><h3>2020-12-08 12:08</h3></div><div id="stylemd" class="sc-bdvvtL fnZpqS"><blockquote><p>项目要做一个可以为日记添加音乐的小程序，所以要用到音乐api，参考了一些文章后我们封装了一个qq音乐api库（完成了动态token获取，音乐搜索，音乐专辑图片，音乐名称，歌手名称，播放），有需要的可以到Github自提。  </p></blockquote><p>小程序qq音乐api库Gihub地址<a href="https://github.com/FisherWY/QQMusicPlugin">https://github.com/FisherWY/QQMusicPlugin</a>，里面有简单的教程，如果开发工具不勾选ES6转ES5的话，则可以不需要里面的es6-promise这个js文件，并把<code>var Promise = require(&#x27;./es6-promise.min.js&#x27;)</code>在qqMusicTools.js中去掉。</p><h3>播放背景音乐失败的解决方案</h3><ol><li><p>没有为音乐设置title
解决方案：在设置背景音乐的时候设置title:&quot;随便设置点东西&quot;</p></li><li><p>请求的url中带有中文路径
使用encodeURI(&quot;xxxxxx&quot;)转码</p></li><li><p>手机设置了静音模式</p></li><li><p>一个非常奇葩的问题（翻遍了互联网都没找到解决方案，怀疑是官方的bug了）
android端（移动数据、WiFi、热点一切正常），电脑模拟器（开WiFi，3G各种模式都正常）都可以正常播放，iOS使用WiFi时正常播放，iOS使用移动数据、热点的时候无法播放，报错如下：</p><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript"><div class="token-line" style="color:#000000"><span class="token plain">errCode</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token number" style="color:rgb(9, 134, 88)">10002</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">errMsg</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;playerErrCode:6, systemErrCode:403, domain:com.tencent.KSAudioPlayer.HTTP, description:未能完成操作。（“com.tencent.KSAudioPlayer.HTTP”错误 403。）&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">src</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://ws.stream.qqmusic.qq.com/C400002WqezQ4dmIeT.m4a?guid=126548448&amp;vkey=0E12BA0C521F05EF0103E99180DC5C50CA0E942E3183546F5D186F3E6F20F161E9EB0DCEA038F0A9A578E2DFAEBF434AF48521DA440A7EFF&amp;fromtag=0&quot;</span></div></pre></div><p><del>暂时没有找到解决方案，但是问题只在qq音乐api上出现，使用网易云完全正常。下一步准备使用网易云api代替qq音乐api</del>。已经开发新的网易云api代替qq音乐api了，需要的可以看看这个项目：<a href="https://github.com/JabinGP/NetEaseCloudMusicApi">为微信小程序开发的网易云音乐api库</a>。</p></li></ol></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/code/mini-program-music";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-71841f628f9c8d668040.js"],"app":["/app-83ce6fd2f1ccc517e165.js"],"component---src-pages-404-js":["/component---src-pages-404-js-46407eeca50ec9ed10bd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-990038c5763b601e59d3.js"],"component---src-pages-post-js":["/component---src-pages-post-js-89ead2517795a9cdec6e.js"],"component---src-pages-search-js":[]};/*]]>*/</script><script src="/polyfill-71841f628f9c8d668040.js" nomodule=""></script><script src="/component---src-pages-post-js-89ead2517795a9cdec6e.js" async=""></script><script src="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-2cd4cc2d289335376890.js" async=""></script><script src="/app-83ce6fd2f1ccc517e165.js" async=""></script><script src="/framework-69325bf178eabe561408.js" async=""></script><script src="/webpack-runtime-dea9e12160a7e4b9ddde.js" async=""></script></body></html>
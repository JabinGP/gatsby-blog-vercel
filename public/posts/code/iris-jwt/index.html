<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-4d85f0db60239d65ce1c.js"/><link as="script" rel="preload" href="/framework-69325bf178eabe561408.js"/><link as="script" rel="preload" href="/app-3ff784bf8da428e12e35.js"/><link as="script" rel="preload" href="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-a0f10e8d1673b14c59a5.js"/><link as="script" rel="preload" href="/component---src-pages-post-js-300889cef02639e944c7.js"/><link as="fetch" rel="preload" href="/page-data/posts/code/iris-jwt/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><title>iris的jwt实践，获取jwt、携带jwt、验证jwt、设置过期时间、自定义错误处理函数、格式化错误返回</title><div class="sc-dkPtRN kgstGl"><div class="sc-hKwDye cUWynP"><h1>iris的jwt实践，获取jwt、携带jwt、验证jwt、设置过期时间、自定义错误处理函数、格式化错误返回</h1><h3>2020-12-08 13:21</h3></div><div id="stylemd" class="sc-bdvvtL hlRsZa"><blockquote><p>由于jwt原理已经有很多文章提及过了，这里不再赘述，本文主要介绍jwt在iris中的实践，文章的最后会给出完整代码，可以运行起来边测试边看。
如果文章对你有帮助，点个赞或者留下评论将会是对我的极大鼓励！</p></blockquote><h2>jwt使用方向</h2><p>本文将jwt用于登录功能，如果是其他功能需求其实也类似，可以触类旁通。</p><h2>iris中jwt的使用思想</h2><p>iris基于中间件思想设计，对于一些重复性的操作，可以通过注册中间件来完成。对于登录功能，我们自然不希望每个api中手动判断是否过期，是否合法等，因为我们需要一个jwt中间件来完成这些操作。</p><h2>获取jwt中间件</h2><p>这是一个iris官方提供的jwt中间件：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/iris-contrib/middleware/jwt&quot;</span></div></pre></div><p>用法如下：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token plain">j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor属性可以选择从什么地方获取jwt进行验证，默认从http请求的header中的Authorization字段提取，也可指定为请求参数中的某个字段</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求参数token中提取</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor: jwt.FromParameter(&quot;token&quot;),</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求头的Authorization字段中提取，这个是默认值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    Extractor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">FromAuthHeader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个函数返回秘钥，关键在于return []byte(&quot;这里设置秘钥&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ValidationKeyGetter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个加密方法</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    SigningMethod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p><code>jwt.Config</code>中还有一些可以设置的参数，但是便于理解，以以上三个参数作为演示</p><h2>使用jwt中间件</h2><p>由于并非所有接口都需要设置登录拦截，所以将中间件用于路由，或者路由组是比较符合业务需求的做法</p><p>先给出两个接口：</p><ol><li>&quot;/getJWT&quot;：生成jwt并返回</li><li>&quot;/showHello&quot;：没有任何限制，访问就输出&quot;Hello Iris JWT&quot;</li></ol><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/kataras/iris/v12&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/iris-contrib/middleware/jwt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  app </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/getJWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 往jwt中写入了一对值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    token </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">NewTokenWithClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 签名生成jwt字符串</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">SignedString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showHello&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello Iris JWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Addr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>访问<a href="http://localhost:8080/getJWT">http://localhost:8080/getJWT</a>返回一串类似这样的字符串</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw&quot;</span></div></pre></div><p>访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello Iris JWT&quot;</span></div></pre></div><p>现在我们要对<code>showHello</code>接口加上jwt验证，需要用到上一小节的jwt中间件</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/kataras/iris/v12&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/iris-contrib/middleware/jwt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  app </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor属性可以选择从什么地方获取jwt进行验证，默认从http请求的header中的Authorization字段提取，也可指定为请求参数中的某个字段</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求参数token中提取</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor: jwt.FromParameter(&quot;token&quot;),</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求头的Authorization字段中提取，这个是默认值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    Extractor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">FromAuthHeader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个函数返回秘钥，关键在于return []byte(&quot;这里设置秘钥&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ValidationKeyGetter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个加密方法</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    SigningMethod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/getJWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 往jwt中写入了一对值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    token </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">NewTokenWithClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 使用设置的秘钥，签名生成jwt字符串</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">SignedString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 注意这里加了j.Serve作为路由的中间件</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showHello&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello Iris JWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Addr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="cmd"><pre class="prism-code language-cmd"><div class="token-line" style="color:#000000"><span class="token plain">required authorization token not found</span></div></pre></div><p>由于开启了jwt认证，你可能会想到，给<code>Header</code>中加入一个字段<code>Authorization</code>，然后值为刚刚<code>getJWT</code>接口返回的字符串就可以成功通过这个验证了。</p><h3>测试JWT验证</h3><p>在<code>Postman</code>（或者其他测试工具，都一样）中请求的<code>Headers</code>中加入一对值</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr></tbody></table></div><p>访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="cmd"><pre class="prism-code language-cmd"><div class="token-line" style="color:#000000"><span class="token plain">Authorization header format must be Bearer {token}</span></div></pre></div><p>可能你会纳闷，这个<code>Authorization header format must be Bearer {token}</code>是什么意思？按逻辑来讲，我们的做法应该是没有错的。确实，就两次请求的变化来看，<code>Headers</code>加入的<code>Authorization</code>的的确确被识别到了，但是似乎还有些小问题，根据提示，是格式上还有些出入。</p><p>在<code>Postman</code>（或者其他测试工具，都一样）中请求的<code>Headers</code>中更改<code>Authorization</code>值为</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr></tbody></table></div><p>这样似乎符合<code>Bearer {token}</code>格式了，访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token plain">Authorization header format must be Bearer </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>说明格式还是不对。</p><p>继续修改<code>Headers</code></p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr></tbody></table></div><p>访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello Iris JWT&quot;</span></div></pre></div><p>这次终于返回<code>&quot;Hello Iris JWT&quot;</code>了，说实话这个格式要求和这个提示有点坑。</p><h3>JWT中间件做了什么</h3><p>可以看到，我们的<code>/showHello</code>接口纯粹就是返回<code>&quot;Hello Iris JWT&quot;</code>，没有做任何和JWT有关的操作，但是由于我们在路由上使用了JWT中间件，我们的<code>/showHello</code>接口具有了<code>自动JWT验证</code>的功能，这是JWT中间件在执行我们的接口代码之前，自动帮我们做的。</p><p>修改<code>Headers</code>中的<code>Authorization</code>的值，偷偷把最后一个字符改成其他，看看接口是否能够验证出阿里这是一个假的jwt</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization（真）</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr><tr><td>Authorization（假）</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uu</td></tr></tbody></table></div><p>访问<a href="http://localhost:8080/showHello">http://localhost:8080/showHello</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token plain">signature is invalid</span></div></pre></div><p>可见不合法的jwt是无法通过验证的。</p><h3>获取JWT中的值</h3><p>JWT中间件在验证失败的时候，接口中的代码不会被执行，请求在JWT验证的时候就被响应<code>signature is invalid</code>并结束。
而当JWT中间件验证成功的时候，我们则可以在接口中获取到JWT的信息，我们添加一个接口<code>/showJWT</code>，来输出JWT的结构：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token plain">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p>同样需要设置<code>Headers</code>带上jwt</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr></tbody></table></div><p>访问<a href="http://localhost:8080/showJWT">http://localhost:8080/showJWT</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Raw&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Method&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;HS256&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;Hash&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Header&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;alg&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;HS256&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;typ&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;JWT&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Claims&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;foo&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bar&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Signature&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Valid&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>可以看到<code>Claims</code>里面就有我们签发jwt的时候写入的数据了，如果想要在接口中拿到：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token plain">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWTFoo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  foo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Claims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p>设置<code>Headers</code>带上jwt</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIifQ.4aQan-XvJBjDUDbCVnuh2P_xy54b2aRKKsgKcHUa8uw</td></tr></tbody></table></div><p>访问<a href="http://localhost:8080/showJWTFoo">http://localhost:8080/showJWTFoo</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;bar&quot;</span></div></pre></div><h3>设置过期时间</h3><p>由于jwt签发出去之后，后端并不存储，所以相当于后端并不能管理签发出去的jwt，这种情况下后端自然不能让签发出去的jwt永久有效，需要根据需求设置一个过期时间。</p><p>新增一个获取JWT的接口，这次在<code>Claims</code>中写入更多的数据：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token plain">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/getJWTWithExp&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  token </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">NewTokenWithClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 根据需求，可以存一些必要的数据</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;userName&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;JabinGP&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;userId&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;admin&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 签发人</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iss&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iris&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 签发时间</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iat&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Now</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Unix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设定过期时间，便于测试，设置1分钟过期</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;exp&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Now</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Minute </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Duration</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Unix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 使用设置的秘钥，签名生成jwt字符串</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">SignedString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p>请求<a href="http://localhost:8080/getJWTWithExp">http://localhost:8080/getJWTWithExp</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZXhwIjoxNTc1Mzc5OTk0LCJpYXQiOjE1NzUzNzk5MzQsImlzcyI6ImlyaXMiLCJ1c2VySWQiOiIxIiwidXNlck5hbWUiOiJKYWJpbkdQIn0.AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgg&quot;</span></div></pre></div><p>设置<code>Headers</code>带上新的jwt</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZXhwIjoxNTc1Mzc5OTk0LCJpYXQiOjE1NzUzNzk5MzQsImlzcyI6ImlyaXMiLCJ1c2VySWQiOiIxIiwidXNlck5hbWUiOiJKYWJpbkdQIn0.AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgg</td></tr></tbody></table></div><p>访问<a href="localhost:8080/showJWT">localhost:8080/showJWT</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Raw&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZXhwIjoxNTc1Mzc5OTk0LCJpYXQiOjE1NzUzNzk5MzQsImlzcyI6ImlyaXMiLCJ1c2VySWQiOiIxIiwidXNlck5hbWUiOiJKYWJpbkdQIn0.AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgg&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Method&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;HS256&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;Hash&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Header&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;alg&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;HS256&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;typ&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;JWT&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Claims&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;admin&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;exp&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1575379994</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;iat&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1575379934</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;iss&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iris&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;userId&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token property">&quot;userName&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;JabinGP&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Signature&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgg&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;Valid&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>隔一分钟后，再次请求<a href="localhost:8080/showJWT">localhost:8080/showJWT</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token plain">Token is expired</span></div></pre></div><p>说明过期时间设置生效。</p><h3>设置错误返回格式</h3><p>由于JWT中间件在检验jwt发现不合法时，会自动响应返回错误信息并结束请求，如上所示，错误都是一句话，这样的错误对于前端来说非常不友好，前端更希望能通过一个状态码来判断请求是否顺利。</p><p>首先定义一个响应数据的模板：</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// ResModel 返回数据模板</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token plain"> ResModel </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Code </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;code&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Msg  </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;msg&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Data </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;data&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>获取一个新的中间件，与之前不同的是自定义了错误处理函数（扒了源码改的）:</p><p>注意引入的context是iris包下的，否则无法符合错误处理函数的定义。</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/kataras/iris/v12/context&quot;</span></div></pre></div><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// j2 对比 j 添加了错误处理函数</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">j2 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 注意，新增了一个错误处理函数</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ErrorHandler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> err </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">StopExecution</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">StatusCode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">StatusUnauthorized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ResModel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      Code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;501&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      Msg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  err</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个函数返回秘钥，关键在于return []byte(&quot;这里设置秘钥&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ValidationKeyGetter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个加密方法</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  SigningMethod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p>在一个新的接口上应用新的<code>j2</code>中间件</p><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token plain">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWTErrWithFormat&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span></div></pre></div><p>设置<code>Headers</code>带上一个过期的jwt</p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZXhwIjoxNTc1Mzc5OTk0LCJpYXQiOjE1NzUzNzk5MzQsImlzcyI6ImlyaXMiLCJ1c2VySWQiOiIxIiwidXNlck5hbWUiOiJKYWJpbkdQIn0.AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgg</td></tr></tbody></table></div><p>访问<a href="localhost:8080/showJWT">localhost:8080/showJWT</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;code&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;501&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;msg&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Token is expired&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;data&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token null keyword" style="color:rgb(0, 0, 255)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>篡改<code>Headers</code>中<code>Authorization</code>的值，把最后一个字符改成其他的：<code>g</code>-&gt;<code>o</code></p><div class="sc-gsDKAQ fpSTdO"><table><thead><tr><th>kEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Authorization</td><td>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZXhwIjoxNTc1Mzc5OTk0LCJpYXQiOjE1NzUzNzk5MzQsImlzcyI6ImlyaXMiLCJ1c2VySWQiOiIxIiwidXNlck5hbWUiOiJKYWJpbkdQIn0.AMFZNbtERLHzKAR9z7oF_0QeNoARKr4dkjocNbVsWgo</td></tr></tbody></table></div><p>访问<a href="localhost:8080/showJWT">localhost:8080/showJWT</a>返回</p><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json"><div class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;code&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;501&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;msg&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;signature is invalid&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">&quot;data&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token null keyword" style="color:rgb(0, 0, 255)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div><p>至此，jwt基本符合使用需求了，最后附上完整的代码。</p><h2>完整代码</h2><blockquote><p>如果文章对你有帮助，点个赞或者留下评论将会是对我的极大鼓励！</p></blockquote><div class="gatsby-highlight" data-language="go"><pre class="prism-code language-go"><div class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/kataras/iris/v12&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/iris-contrib/middleware/jwt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;github.com/kataras/iris/v12/context&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// ResModel 返回数据模板</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token plain"> ResModel </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Code </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;code&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Msg  </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;msg&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  Data </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">`json:&quot;data&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  app </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor属性可以选择从什么地方获取jwt进行验证，默认从http请求的header中的Authorization字段提取，也可指定为请求参数中的某个字段</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求参数token中提取</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// Extractor: jwt.FromParameter(&quot;token&quot;),</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 从请求头的Authorization字段中提取，这个是默认值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    Extractor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">FromAuthHeader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个函数返回秘钥，关键在于return []byte(&quot;这里设置秘钥&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ValidationKeyGetter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个加密方法</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    SigningMethod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// j2 对比 j 添加了错误处理函数</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  j2 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">New</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 注意，新增了一个错误处理函数</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ErrorHandler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> err </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">      ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">StopExecution</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">StatusCode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">StatusUnauthorized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ResModel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        Code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;501&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">        Msg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  err</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个函数返回秘钥，关键在于return []byte(&quot;这里设置秘钥&quot;)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ValidationKeyGetter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设置一个加密方法</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    SigningMethod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/getJWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 往jwt中写入了一对值</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    token </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">NewTokenWithClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 使用设置的秘钥，签名生成jwt字符串</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">SignedString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/getJWTWithExp&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    token </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">NewTokenWithClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SigningMethodHS256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 根据需求，可以存一些必要的数据</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;userName&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;JabinGP&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;userId&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;admin&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 签发人</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iss&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iris&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 签发时间</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;iat&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Now</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Unix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 设定过期时间，便于测试，设置1分钟过期</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;exp&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Now</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Minute </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Duration</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Unix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 使用设置的秘钥，签名生成jwt字符串</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">SignedString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token function" style="color:rgb(0, 0, 255)">byte</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;My Secret&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tokenString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showHello&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Hello Iris JWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWTFoo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    foo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Claims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">MapClaims</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/showJWTErrWithFormat&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Serve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ctx iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    jwtInfo </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jwt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">jwt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">JSON</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jwtInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#000000"><span class="token plain">  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Addr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span></div></pre></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/code/iris-jwt";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-71841f628f9c8d668040.js"],"app":["/app-3ff784bf8da428e12e35.js"],"component---src-pages-404-js":["/component---src-pages-404-js-46407eeca50ec9ed10bd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4ee3c921437b1bbd4a50.js"],"component---src-pages-post-js":["/component---src-pages-post-js-300889cef02639e944c7.js"],"component---src-pages-search-js":["/component---src-pages-search-js-aa816b57753a46283b1c.js"]};/*]]>*/</script><script src="/polyfill-71841f628f9c8d668040.js" nomodule=""></script><script src="/component---src-pages-post-js-300889cef02639e944c7.js" async=""></script><script src="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-a0f10e8d1673b14c59a5.js" async=""></script><script src="/app-3ff784bf8da428e12e35.js" async=""></script><script src="/framework-69325bf178eabe561408.js" async=""></script><script src="/webpack-runtime-4d85f0db60239d65ce1c.js" async=""></script></body></html>
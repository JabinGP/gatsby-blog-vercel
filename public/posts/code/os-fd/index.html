<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-fe05e40fb0f9fc3dbf0e.js"/><link as="script" rel="preload" href="/framework-69325bf178eabe561408.js"/><link as="script" rel="preload" href="/app-83ce6fd2f1ccc517e165.js"/><link as="script" rel="preload" href="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-5913af22e5b378b2ad63.js"/><link as="script" rel="preload" href="/component---src-pages-post-js-89ead2517795a9cdec6e.js"/><link as="fetch" rel="preload" href="/page-data/posts/code/os-fd/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-dkPtRN kgstGl"><div class="sc-hKwDye cUWynP"><h1>操作系统系列之——文件描述符</h1><h3>2021-01-14 13:33</h3></div><div id="stylemd" class="sc-bdvvtL fnZpqS"><p>注：以下的 Unix 泛指 Unix 、 Linux 、 macOS 等系统。</p><h2>一切皆文件</h2><p>在 Unix 中有一种简单而实用的哲学叫做 <em>一切皆文件</em> ：文件是文件、设备是文件......</p><h2>打开是第一步</h2><p>一个实实在在的普通文件在使用之前必须要经过一个叫做 <strong>打开</strong> 的过程，通常在程序中表现为 <code>open()</code> 函数调用的形式，文件必须先被打开的原因是系统需要把文件属性和磁盘地址表装入内存以便于后续的快速访问。</p><h2>返回凭证</h2><p>文件在成功打开后，系统会返回一个 <strong>非负整数</strong> 作为文件的描述符，文件描述符将作为引用该文件的一个凭证，例如后续对该文件的读或写操作则需要将文件描述符传递给 <code>read()</code> 或 <code>write()</code> 函数。</p><h2>文件描述符的一些属性</h2><p>按照惯例，UNIX 系统 shell 使用文件描述 0 关联进程的标准输入、 1 关联标准输出、 2 关联标准错误输出。这是各种 shell 以及很多应用程序使用的管理，并非 UNIX 内核强制要求，但如果不遵照这个惯例，很多 UNIX 系统引用程序就并无法正常工作。</p><p>// TODO: POSIX 标准</p><p>在遵从 POSIX 标准的应用程序中，与标准输入、标准输出、标准错误输出想关的 0 、 1 、 2 、应该使用被定义在头文件 <code>&lt;unistd.h&gt;</code> 的符号常量 <code>STDIN_FILENO</code> 、 <code>STDOUT_FILENO</code> 、 <code>STDERR_FILENO</code> 来替换。</p><h2>文件描述符的服务对象</h2><p>文件描述符的产生归根结底是因为 <strong>进程需要使用</strong> 某个文件，因此文件描述符的诞生就是为了进程而服务的。</p><p>因为文件描述符的针对的对象是进程，因此每个进程的文件描述符都是独立的，相同的数字在不同的进程之间的所代表的文件可以是不同的，例如同一个文件描述符 4 在 <code>进程1</code> 中代表 <code>文件a</code>，而在 <code>进程2</code> 中代表 <code>文件b</code> 。</p><h2>文件描述符的取值范围</h2><p>如上所述，文件描述符本质上就是一个用来标识文件的 <strong>非负整数</strong> ，而文件描述符范围是 <!-- -->[ 0, <code>OPEN_MAX</code> ]<!-- --> 。</p><p>早期的 UNIX 系统实现采用的上限是 19 （即 <!-- -->[0, 19]<!-- --> 共 20 个取值），这意味着一个进程至多只能同时使用 20 个文件秒描述符，当需要操作的文件过多时，这可能会产生一些麻烦，但现在的操作系统已经增加至上万了，基本不存在文件描述符用完的困扰。</p><p>有关 <code>OPEN_MAX</code> 的详细，可以参考 <a href="https://blog.csdn.net/CMbug/article/details/48313107">获取进程能打开的最大文件数量【OPEN_MAX】</a>。</p><h2>参考</h2><ul><li><em>《现代操作系统（第四版）》</em></li><li><em>《Unix环境高级编程（第四版）》</em></li></ul></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/code/os-fd";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-71841f628f9c8d668040.js"],"app":["/app-83ce6fd2f1ccc517e165.js"],"component---src-pages-404-js":["/component---src-pages-404-js-46407eeca50ec9ed10bd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-990038c5763b601e59d3.js"],"component---src-pages-post-js":["/component---src-pages-post-js-89ead2517795a9cdec6e.js"],"component---src-pages-search-js":[]};/*]]>*/</script><script src="/polyfill-71841f628f9c8d668040.js" nomodule=""></script><script src="/component---src-pages-post-js-89ead2517795a9cdec6e.js" async=""></script><script src="/46cc0ad690e07bdb83aca0e2e42f847dc2691093-5913af22e5b378b2ad63.js" async=""></script><script src="/app-83ce6fd2f1ccc517e165.js" async=""></script><script src="/framework-69325bf178eabe561408.js" async=""></script><script src="/webpack-runtime-fe05e40fb0f9fc3dbf0e.js" async=""></script></body></html>